# 12.3 Развертывание кластера на собственных серверах, лекция 1
> Поработав с персональным кластером, можно заняться проектами. Вам пришла задача подготовить кластер под новый проект.

## Задание 1: Описать требования к кластеру
>Сначала проекту необходимо определить требуемые ресурсы. Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:
>
>* База данных должна быть отказоустойчивой. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии.
>* Кэш должен быть отказоустойчивый. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии.
>* Фронтенд обрабатывает внешние запросы быстро, отдавая статику. Потребляет не более 50 МБ ОЗУ на каждый экземпляр, 0.2 ядра. 5 копий.
>* Бекенд потребляет 600 МБ ОЗУ и по 1 ядру на копию. 10 копий.
>
>План расчета
>1. Сначала сделайте расчет всех необходимых ресурсов.
>2. Затем прикиньте количество рабочих нод, которые справятся с такой нагрузкой.
>3. Добавьте к полученным цифрам запас, который учитывает выход из строя как минимум одной ноды.
>4. Добавьте служебные ресурсы к нодам. Помните, что для разных типов нод требовния к ресурсам разные.
>5. Рассчитайте итоговые цифры.
>6. В результате должно быть указано количество нод и их параметры.

**Ответ**

1. Нам требуется:
   * БД - 3 копии * 1 ядро = 3 ядра и 3 копии * 4 ОЗУ = 12 ГБ ОЗУ
   * КЭШ - 3 копии * 1 ядро = 3 ядра и 3 копии * 4 ОЗУ = 12 ГБ ОЗУ
   * Фронт - 5 копий * 0.2 ядра = 1 ядро и 5 копий * 0.05 ОЗУ = 0.25 ГБ ОЗУ
   * Бек - 10 копий * 1 ядро = 10 ядер и 10 копий * 0.6 ГБ ОЗУ = 6 ГБ ОЗУ 
   * Итого - чистых требований на 3 + 3 + 1 + 10 = 17 ядер и 12 + 12 + 0.25 + 6 = 30.25 ГБ ОЗУ
2. Рабочие ноды:
   * Чтобы не было борьбы за операции ввода-вывода (особенно БД), нам нужно количество рабочих нод не меньше 3. 
   * Если рабочих нод 3, то можно расскидать поды так: 
     - 1 БД + 1 КЭШ + 2 Фронта + 3 Бека = 1 + 1 + 2 * 0.2 + 3 * 1 = 5.4 ядра и 4 + 4 + 2 * 0.05 + 3 * 0.6 = 9.9 ГБ ОЗУ
     - 1 БД + 1 КЭШ + 2 Фронта + 3 Бека = 1 + 1 + 2 * 0.2 + 3 * 1 = 5.4 ядра и 4 + 4 + 2 * 0.05 + 3 * 0.6 = 9.9 ГБ ОЗУ
     - 1 БД + 1 КЭШ + 1 Фронт + 4 Бека =  1 + 1 + 1 * 0.2 + 4 * 1 = 6.2 ядра и 4 + 4 + 1 * 0.05 + 4 * 0.6 = 10.45 ГБ ОЗУ
   * Если рабочих нод 4, то можно расскидать поды так:
     - 1 БД + 0 КЭШ + 2 Фронта + 4 Бека = 1 + 0 + 2 * 0.2 + 4 * 1 = 4.4 ядра и 4 + 0 + 2 * 0.05 + 4 * 0.6 = 6.5 ГБ ОЗУ
     - 0 БД + 1 КЭШ + 1 Фронта + 4 Бека = 0 + 1 + 1 * 0.2 + 4 * 1 = 4.2 ядра и 0 + 4 + 1 * 0.05 + 4 * 0.6 = 6.45 ГБ ОЗУ
     - 1 БД + 1 КЭШ + 1 Фронта + 1 Бека = 1 + 1 + 1 * 0.2 + 1 * 1 = 3.2 ядра и 4 + 4 + 1 * 0.05 + 1 * 0.6 = 8.65 ГБ ОЗУ
     - 1 БД + 1 КЭШ + 1 Фронта + 1 Бека = 1 + 1 + 1 * 0.2 + 1 * 1 = 3.2 ядра и 4 + 4 + 2 * 0.05 + 1 * 0.6 = 8.65 ГБ ОЗУ

У нас есть требования к отказоустойчивости. Поэтому контрол-нод должно быть больше одной - ближайшее нечётное 3 ноды.
Требования к количеству - нечётное, поэтому в итоге получаем 3 контрол-ноды
2. На контрол-нодах будет располагаться etcd (в минимальном варианте, либо вообще жить отдельно), значит не очень хорошо туда ставить 
